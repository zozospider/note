


---

# 一 概述

压缩技术能够有效减少底层存储系统 (HDFS) 读写字节数. 压缩提高了网络宽带和磁盘空间的效率. 在运行 MapReduce 程序时, IO 操作, 网络数据传输, Shuffle 和 Merge 要花费大量的时间, 尤其是数据规模很大和共哟负载密集的情况下, 因此, 使用数据压缩显得非常重要.

鉴于磁盘 IO 和网络带宽是 Hadoop 的宝贵资源, 数据压缩对于节省资源, 最小化磁盘 IO 和网络传输非常有帮助. 可以在任意 MapReduce 阶段启用压缩. 不过, 尽管压缩与解压缩操作的 CPU 开销不高, 其性能的提升和资源的节省并非没有代价.

---

# 二 压缩策略和原则

压缩是提高 Hadoop 运行效率的一种优化策略. 通过对 Mapper, Reducer 运行过程的数据进行压缩, 以减少磁盘 IO, 提高 MapReduce 程序运行速度.

但是采用压缩技术减少磁盘 IO 的同时也增加了 CPU 运算负担, 所有压缩特性运用得当能够提高性能, 运用不当也可能降低性能. 压缩基本原则如下:
- 运算密集型的 Job, 少用压缩.
- IO 密集型的 Job, 多用压缩.

---

# 三 压缩编码方式

- MapReduce 支持的压缩编码方式如下:

| 压缩格式 | 编解码器 |
| :--- | :--- |
| Deflate | `org.apache.hadoop.io.compress.DeflateCodec` |
| Gzip | `org.apache.hadoop.io.compress.GzipCodec` |
| BZip2 | `org.apache.hadoop.io.compress.BZip2Codec` |
| LZO | `com.hadoop.compression.lzo.LzopCodec` |
| Snappy | `org.apache.hadoop.io.compress.SnappyCodec` |

| 压缩格式 | 是否 Hadoop 自带 | 算法 | 文件扩展名 | 是否可切片 | 换成压缩格式后, 原程序是否需要修改 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| Deflate | 是 | Deflate | .deflate | 否 | 和文本处理一样, 不需要修改 |
| Gzip | 是 | Deflate | .gz | 否 | 和文本处理一样, 不需要修改 |
| BZip2 | 是 | BZip2 | .bz2 | 是 | 和文本处理一样, 不需要修改 |
| LZO | 否, 需安装 | LZO | .lzo | 是 | 需要建索引, 需要指定输入格式 |
| Snappy | 否, 需安装 | Snappy | .snappy | 否 | 和文本处理一样, 不需要修改 |

- 压缩性能比较:

| 压缩算法 | 原始文件大小 | 压缩文件大小 | 压缩速度 | 解压速度 | 备注 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| Gzip | 8.3GB | 1.8GB | 17.5MB/s | 58MB/s | |
| BZip2 | 8.3GB | 1.1GB | 2.4MB/s | 9.5MB/s | |
| LZO | 8.3GB | 2.9GB | 49.3MB/s | 74.6MB/s | |
| Snappy | | | 250MB/s | 500MB/s | http://google.github.io/snappy/ |

---

# 四 压缩选择

## Gzip

__优点__:
- 压缩率较高, 压缩 / 解压速度较快.
- Hadoop 本身支持, 无需安装, 在应用中处理 BZip2 格式的文件就和直接处理文本一样. 且大部分 Linux 系统都自带 Gzip 命令, 使用方便.

__缺点__:
- 不支持 Split.

__应用场景__:
- 当每个文件压缩之后在 130M 以内 (1 个块大小以内), 可以考虑用 Gzip 压缩. 例如 1 天或者 1 小时的日志压缩成一个 Gzip 文件.

## BZip2

__优点__:
- 支持 Split.
- 压缩率很高 (比 Gzip 压缩率高).
- Hadoop 本身支持, 无需安装, 在应用中处理 BZip2 格式的文件就和直接处理文本一样.

__缺点__:
- 压缩 / 解压速度很慢.

__应用场景__:
- 1. 适合对速度要求不高, 但需要较高对压缩率对时候.
- 2. 输出之后对数据较大, 处理后对数据需要压缩存档以减少磁盘空间且以后数据使用较少.
- 3. 对单个很大对文本文件想压缩减少存储空间, 同时又需要支持 Split, 且兼容之前对应用程序.

## LZO

__优点__:
- 压缩率适中 (比 Gzip 低), 压缩 / 解压速度较快.

__缺点__:
- 在应用中对 LZO 格式对文件需要做一些特殊处理 (为了支持 Split 需要建索引, 还需要指定 InputFormat 为 LZO 格式).
- Hadoop 本身不支持, 需要安装.

__应用场景__:
- 一个很大对文本文件, 压缩之后还大于 200M 以上可以考虑, 且单个文件越大, 优点越明显.

## Snappy

__优点__:
- 压缩率适中 (比 Gzip 低)， 压缩 / 解压速度很快.

__缺点__:
- 不支持 Split.
- Hadoop 本身不支持, 需要安装.

__应用场景__:
- 当 MapReduce 作业的 Map 输出的数据比较大的时候, 作为 Map 到 Reduce 的中间数据的压缩格式.
- 作为 1 个 MapReduce 作业的输出和另 1 个 MapReduce 作业的输入.

---

# 五 压缩位置选择

![image]()

---

# 六 

---
