
# 大纲

`ZooKeeper 原理与实践`

- 事务
  - ACID
  - 弱隔离级别
  - 串行化
- 复制
  - 主节点与从节点
  - 复制滞后问题
- 分布式系统的挑战
  - 不可靠的网络
  - 不可靠的时钟
- 一致性与共识
  - 顺序和一致性 (可线性化)
  - 两阶段提交
  - 全序关系广播
  - 成员与协调服务 (ZooKeeper)
- ZooKeeper
  - ZooKeeper 概念
    - 事务日志 & 快照
    - 角色
    - 会话
  - ZooKeeper 应用
    - 开源软件
    - Demo
    - Configurator

# 总体进度

从单节点事务开始讲述普通的数据系统满足的 ACID 特性
- 1. 并讲述其中的隔离级别
  - 脏读, 脏写 -> 读 - 提交
  - 读倾斜 -> 可重复读
  - 写倾斜 -> 防止更新丢失
- 2. 串行化
  - 存储过程
  - 两阶段加锁
  - 悲观与乐观的并发控制

然后引入多节点系统
- 1. 介绍主要的分类:
  - 多主, 无主, 主从 (脑裂), 分区, 复制
  - 分布式: 高性能, 云计算
- 2. 说明其中的挑战:
  - 网络
  - 时钟
  - 拜占庭式故障
- 3. 说明需求:
  - 顺序概念和一致性保证 (可线性化)
  - 原子事务提交
  - 锁与租约 / 唯一性约束
  - 成员 / 协调服务
- 4. 并表示需要一个理论系统模型与现实, 从而引出共识算法解决所有需求.
- 5. 然后引入 2PC 解决共识问题并说明缺点.
- 6. 然后引出全序关系广播解决共识问题. (Raft, Zab, Paxos)
- 7. 并进而引出 ZOoKeeper 通过全序关系广播解决共识问题的实践. (线性化的原子操作)
- 9. 介绍 ZooKeeper
- 10. ZooKeeper 架构和特性:
  - 数据结构, cversion, zxid, ACL > 操作全序
  - Watcher > 故障检测, 更改通知
  - 角色 (Leader, Follower, Observer), 会话, Leader 选举
  - 事务日志 & 快照
- 11. ZooKeeper 应用
  - 开源软件
  - Demo
  - Configurator

多节点数据系统存在复制滞后, 节点失效, 脑裂, 网络, 时钟, 拜占庭故障等诸多问题.
作为技术人员, 我们应该以严谨的态度认真对待, 墨菲定律: 所有可能出错的事情一定会出错.


通常在初期的版本, 用 ZooKeeper 解决做分布式协调服务是一个不错的选择, 到较高版本时, 也有部分大型系统选择放弃 ZooKeeper, 选择自己开发这一部分以保持更高的可定制化和针对性的优化.
总结: 大部分数据系统主要还是专注于数据写入, 存储, 读取上的优化, 将像 ZooKeeper 这种分布式协调系统用于解决了分布式系统中存在的一部分问题, 分布式系统中还需要面对各种各样的其他挑战.
